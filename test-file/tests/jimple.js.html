<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">tests/jimple.js | Jimple API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/jubianchi/jsimple.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/decorator.js~Decorator.html">Decorator</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/index.js~Jsimple.html">Jsimple</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/index.js~JsimpleProxified.html">JsimpleProxified</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy.js~JsimpleProxy.html">JsimpleProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Extend">Extend</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Factory">Factory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Inject">Inject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Shared">Shared</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Use">Use</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">tests/jimple.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&quot;use strict&quot;;

var Jsimple = require(&quot;../src&quot;);

/** @test {Jsimple} */
describe(&quot;Jsimple&quot;, () =&gt; {
    let jsimple;

    beforeEach(() =&gt; jsimple = new Jsimple());

    /** @test {Jsimple#constructor} */
    describe(&quot;constructor&quot;, () =&gt; {
        it(&quot;should instanciate&quot;, () =&gt; jsimple.should.be.an.object);

        it(&quot;should be empty&quot;, () =&gt; jsimple.keys().should.be.empty);

        it(&quot;should be frozen&quot;, () =&gt; {
            Object.isExtensible(jsimple).should.be.false;
            (() =&gt; jsimple.foo = &quot;bar&quot;).should.throw(Error);
        });
    });

    /** @test {Jsimple#define} */
    describe(&quot;.define&quot;, () =&gt; {
        it(&quot;should return jsimple instance&quot;, () =&gt; jsimple.define(&quot;service&quot;, () =&gt; {}).should.be.equal(jsimple));

        it(&quot;should define service&quot;, () =&gt; jsimple.define(&quot;service&quot;, () =&gt; {}).keys().should.be.eql([&quot;service&quot;]));

        it(&quot;should store callable&quot;, () =&gt; {
            let callable = () =&gt; {};

            jsimple.define(&quot;service&quot;, callable).raw(&quot;service&quot;).should.be.equal(callable);
        });

        it(&quot;should store value as callable&quot;, () =&gt; {
            let value = 42;

            jsimple.define(&quot;service&quot;, value).raw(&quot;service&quot;)().should.be.equal(value);
        });

        it(&quot;should tag callable&quot;, () =&gt; jsimple.define(&quot;service&quot;, () =&gt; {}, [&quot;tag&quot;]).tagged(&quot;tag&quot;).should.be.eql([&quot;service&quot;]));

        it(&quot;should not tag same callable twice&quot;, () =&gt; jsimple.define(&quot;service&quot;, () =&gt; {}, [&quot;tag&quot;]).define(&quot;service&quot;, () =&gt; {}, [&quot;tag&quot;]).tagged(&quot;tag&quot;).should.be.eql([&quot;service&quot;]));
    });

    /** @test {Jsimple#share} */
    describe(&quot;.share&quot;, () =&gt; {
        it(&quot;should return jsimple instance&quot;, () =&gt; jsimple.share(&quot;service&quot;, () =&gt; {}).should.be.equal(jsimple));

        it(&quot;should wrap callable&quot;, () =&gt; {
            let callable = () =&gt; {};

            jsimple.share(&quot;service&quot;, callable);

            jsimple.raw(&quot;service&quot;).should.be.a.Function();
            jsimple.raw(&quot;service&quot;).should.not.be.equal(callable);
        });

        it(&quot;should overwrite existing service&quot;, () =&gt; {
            let callable = () =&gt; {};

            jsimple.share(&quot;service&quot;, callable);
            jsimple.share(&quot;service&quot;, () =&gt; {});

            jsimple.raw(&quot;service&quot;).should.not.be.equal(callable);
        });

        it(&quot;should refuse to override an already fetched service&quot;, () =&gt; {
            jsimple.share(&quot;service&quot;, () =&gt; {}).get(&quot;service&quot;);

            (() =&gt; jsimple.share(&quot;service&quot;, () =&gt; {})).should.throw(Error);
        });

        describe(&quot;factory&quot;, () =&gt; {
            it(&quot;should share service instance&quot;, () =&gt; {
                let service,
                    callable = () =&gt; service = {};

                jsimple.share(&quot;service&quot;, callable);

                jsimple.get(&quot;service&quot;).should.equal(service);
                jsimple.get(&quot;service&quot;).should.be.equal(jsimple.get(&quot;service&quot;));
            });

            it(&quot;should receive jsimple instance as an argument&quot;, () =&gt; {
                let callable = (arg) =&gt; arg.should.be.equal(jsimple);

                jsimple.share(&quot;service&quot;, callable);

                jsimple.get(&quot;service&quot;);
            });
        });
    });

    /** @test {Jsimple#factory} */
    describe(&quot;.factory&quot;, () =&gt; {
        it(&quot;should return jsimple instance&quot;, () =&gt; jsimple.factory(&quot;service&quot;, () =&gt; {}).should.be.equal(jsimple));

        it(&quot;should wrap callable&quot;, () =&gt; {
            let callable = () =&gt; {};

            jsimple.factory(&quot;factory&quot;, callable);

            jsimple.raw(&quot;factory&quot;).should.be.a.Function();
            jsimple.raw(&quot;factory&quot;).should.not.be.equal(callable);
        });

        it(&quot;should refuse to override an already fetched service&quot;, () =&gt; {
            jsimple.share(&quot;service&quot;, () =&gt; {}).get(&quot;service&quot;);

            (() =&gt; jsimple.factory(&quot;service&quot;, () =&gt; {})).should.throw(Error);
        });

        it(&quot;should refuse to override an already executed factory&quot;, () =&gt; {
            jsimple.factory(&quot;factory&quot;, () =&gt; {}).get(&quot;factory&quot;);

            (() =&gt; jsimple.factory(&quot;factory&quot;, () =&gt; {})).should.throw(Error);
        });

        describe(&quot;factory&quot;, () =&gt; {
            it(&quot;should not share service instance&quot;, () =&gt; {
                let callable = () =&gt; ({});

                jsimple.factory(&quot;factory&quot;, callable);

                jsimple.get(&quot;factory&quot;).should.be.an.object;
                jsimple.get(&quot;factory&quot;).should.be.eql({});
                jsimple.get(&quot;factory&quot;).should.not.equal(jsimple.get(&quot;factory&quot;));
            });

            it(&quot;should receive jsimple instance as an argument&quot;, () =&gt; {
                let callable = (arg) =&gt; arg.should.be.equal(jsimple);

                jsimple.factory(&quot;factory&quot;, callable);

                jsimple.get(&quot;factory&quot;);
            });
        });
    });

    /** @test {Jsimple#extend} */
    describe(&quot;.extend&quot;, () =&gt; {
        it(&quot;should return jsimple instance&quot;, () =&gt; jsimple.share(&quot;service&quot;, () =&gt; {}).extend(&quot;service&quot;, () =&gt; {}).should.be.equal(jsimple));

        it(&quot;should extend existing service&quot;, () =&gt; {
            let service,
                callable = () =&gt; service = {};

            jsimple.share(&quot;service&quot;, () =&gt; {});

            jsimple.extend(&quot;service&quot;, callable).get(&quot;service&quot;).should.be.equal(service);
        });

        it(&quot;should receive base service instance as first argument&quot;, () =&gt; {
            let service, extended,
                callable = () =&gt; service = {},
                extendedCallable = (arg) =&gt; arg.should.be.equal(service);

            jsimple.share(&quot;service&quot;, callable);
            jsimple.extend(&quot;service&quot;, extendedCallable);

            jsimple.get(&quot;service&quot;);
        });

        it(&quot;should receive jsimple instance as second argument&quot;, () =&gt; {
            let callable = (service, arg) =&gt; arg.should.be.equal(jsimple);

            jsimple.share(&quot;service&quot;, () =&gt; {});
            jsimple.extend(&quot;service&quot;, callable);

            jsimple.get(&quot;service&quot;);
        });

        it(&quot;should refuse to extend an already fetched service&quot;, () =&gt; {
            jsimple.share(&quot;service&quot;, () =&gt; {}).get(&quot;service&quot;);

            (() =&gt; jsimple.extend(&quot;service&quot;, () =&gt; {})).should.throw(Error);
        });

        it(&quot;should refuse to extend an already used factory&quot;, () =&gt; {
            jsimple.factory(&quot;factory&quot;, () =&gt; {}).get(&quot;factory&quot;);

            (() =&gt; jsimple.extend(&quot;factory&quot;, () =&gt; {})).should.throw(Error);
        });
    });

    /** @test {Jsimple#use} */
    describe(&quot;.use&quot;, () =&gt; {
        it(&quot;should inject jsimple&quot;, () =&gt; jsimple.use((arg) =&gt; arg.should.be.equal(jsimple)));

        it(&quot;should inject given service&quot;, () =&gt; {
            let service,
                callable = () =&gt; service = {};

            jsimple.share(&quot;service&quot;, callable);

            jsimple.use([&quot;service&quot;], (arg) =&gt; arg.should.be.equal(service));
        });

        it(&quot;should inject given services&quot;, () =&gt; {
            let service, otherService,
                callable = () =&gt; service = {},
                otherCallable = () =&gt; otherService = {};

            jsimple.share(&quot;service&quot;, callable);
            jsimple.share(&quot;otherService&quot;, otherCallable);

            jsimple.use([&quot;service&quot;, &quot;otherService&quot;], (arg, otherArg) =&gt; {
                arg.should.be.equal(service);
                otherArg.should.be.equal(otherService);
            });
        });
    });

    /** @test {Jsimple#protect} */
    describe(&quot;.protect&quot;, () =&gt; {
        it(&quot;should wrap callable&quot;, () =&gt; {
            let callable = () =&gt; {};

            jsimple.protect(callable).should.not.be.equal(callable);
            jsimple.protect(callable)().should.be.equal(callable);
        });
    });

    /** @test {Jsimple#raw} */
    describe(&quot;.raw&quot;, () =&gt; {
        it(&quot;should return raw callable&quot;, () =&gt; {
            let callable = () =&gt; {};

            jsimple.define(&quot;service&quot;, callable).raw(&quot;service&quot;).should.be.equal(callable);
        });

        it(&quot;should return raw callable for value&quot;, () =&gt; jsimple.define(&quot;service&quot;, 42).raw(&quot;service&quot;).should.be.a.Function());
    });

    /** @test {Jsimple#tagged} */
    describe(&quot;.tagged&quot;, () =&gt; {
        it(&quot;should return tagged service names&quot;, () =&gt; {
            jsimple.define(&quot;service&quot;, () =&gt; {}, [&quot;tag&quot;, &quot;gat&quot;]);
            jsimple.define(&quot;ecivres&quot;, () =&gt; {}, [&quot;tag&quot;]);

            jsimple.tagged(&quot;tag&quot;).should.be.eql([&quot;service&quot;, &quot;ecivres&quot;]);
            jsimple.tagged(&quot;gat&quot;).should.be.eql([&quot;service&quot;]);
        });

        it(&quot;should return service names associated with several tags&quot;, () =&gt; {
            jsimple.define(&quot;service&quot;, () =&gt; {}, [&quot;tag&quot;, &quot;gat&quot;]);
            jsimple.define(&quot;ecivres&quot;, () =&gt; {}, [&quot;tag&quot;]);
            jsimple.define(&quot;vreseci&quot;, () =&gt; {}, [&quot;gat&quot;]);

            jsimple.tagged(&quot;tag&quot;).should.be.eql([&quot;service&quot;, &quot;ecivres&quot;]);
            jsimple.tagged([&quot;tag&quot;, &quot;gat&quot;]).should.be.eql([&quot;service&quot;]);
        })
    });

    /** @test {Jsimple#proxify} */
    describe(&quot;.proxify&quot;, () =&gt; {
        beforeEach(() =&gt; {
            let should = require(&quot;should&quot;);

            should.extend(&quot;then&quot;, Proxy.prototype);
            should.extend(&quot;Boolean&quot;, Proxy.prototype);
        });

        it(&quot;should return a proxified instance&quot;, () =&gt; jsimple.proxify().should.be.an.instanceof(Jsimple));

        it(&quot;should be extensible&quot;, () =&gt; Object.isExtensible(jsimple.proxify()).should.be.true);

        it(&quot;should be idempotent&quot;, () =&gt; {
            (jsimple.proxify().proxify() === jsimple).should.be.true;
            (jsimple.proxify().proxify() === jsimple.proxify()).should.be.true;
        });

        describe(&quot;traps&quot;, () =&gt; {
            beforeEach(() =&gt; jsimple = jsimple.proxify());

            describe(&quot;.get&quot;, () =&gt; {
                it(&quot;should not override native methods&quot;, () =&gt; {
                    let service,
                        callable = () =&gt; service = {};

                    jsimple.share(&quot;service&quot;, callable);

                    jsimple.get(&quot;service&quot;).should.be.equal(service);
                });

                it(&quot;should fetch service&quot;, () =&gt; {
                    let service,
                        callable = () =&gt; service = {};

                    jsimple.share(&quot;service&quot;, callable);

                    jsimple.service.should.be.equal(service);
                });

                it(&quot;should execute factory&quot;, () =&gt; {
                    let service,
                        callable = () =&gt; service = {};

                    jsimple.factory(&quot;service&quot;, callable);

                    jsimple.service.should.be.an.object;
                    jsimple.service.should.be.eql({});
                    jsimple.service.should.not.equal(jsimple.service);
                });
            });

            describe(&quot;.set&quot;, () =&gt; {
                it(&quot;should refuse to override native methods&quot;, () =&gt; {
                    (() =&gt; jsimple.factory = () =&gt; {}).should.throw(Error);
                    (() =&gt; jsimple.get = () =&gt; {}).should.throw(Error);
                });

                it(&quot;should define a shared service&quot;, () =&gt; {
                    let service;

                    jsimple.service = () =&gt; service = {};

                    jsimple.get(&quot;service&quot;).should.equal(service);
                    jsimple.get(&quot;service&quot;).should.be.equal(jsimple.get(&quot;service&quot;));
                });
            });

            describe(&quot;.has&quot;, () =&gt; {
                it(&quot;should check if service exists&quot;, () =&gt; {
                    jsimple.service = () =&gt; {};

                    (&quot;service&quot; in jsimple).should.be.true;
                    (&quot;factory&quot; in jsimple).should.be.false;
                });

                it(&quot;should check if factory exists&quot;, () =&gt; {
                    jsimple.factory(&quot;service&quot;, () =&gt; {});

                    (&quot;service&quot; in jsimple).should.be.true;
                    (&quot;factory&quot; in jsimple).should.be.false;
                });
            });

            describe(&quot;.delete&quot;, () =&gt; {
                it(&quot;should prevent deletion&quot;, () =&gt; {
                    jsimple.service = () =&gt; {};

                    (() =&gt; delete jsimple.service).should.throw(Error);
                });
            });
        });

        /** @test {Jsimple#share} */
        describe(&quot;.share&quot;, () =&gt; {
            beforeEach(() =&gt; jsimple = jsimple.proxify());

            describe(&quot;factory&quot;, () =&gt; {
                it(&quot;should receive jsimple proxy instance as an argument&quot;, () =&gt; {
                    let otherService,
                        callable = (arg) =&gt; arg.otherService.should.be.equal(otherService),
                        otherCallable = () =&gt; otherService = {};

                    jsimple.share(&quot;service&quot;, callable);
                    jsimple.share(&quot;otherService&quot;, otherCallable);

                    jsimple.get(&quot;service&quot;);
                });
            });
        });

        /** @test {Jsimple#factory} */
        describe(&quot;.factory&quot;, () =&gt; {
            beforeEach(() =&gt; jsimple = jsimple.proxify());

            describe(&quot;factory&quot;, () =&gt; {
                it(&quot;should receive jsimple proxy instance as an argument&quot;, () =&gt; {
                    let service,
                        callable = (arg) =&gt; arg.service.should.be.equal(service),
                        otherCallable = () =&gt; service = {};

                    jsimple.share(&quot;service&quot;, otherCallable);
                    jsimple.factory(&quot;factory&quot;, callable);

                    jsimple.get(&quot;factory&quot;);
                });
            });
        });

        /** @test {JsimpleProxified.fromJsimple} */
        describe(&quot;cast&quot;, () =&gt; {
            it(&quot;should keep current state&quot;, () =&gt; {
                jsimple.share(&quot;service&quot;, () =&gt; ({}));
                jsimple.share(&quot;otherService&quot;, () =&gt; {});
                jsimple.share(&quot;taggedService&quot;, () =&gt; {}, [&quot;tag&quot;]);

                let fetchedService = jsimple.get(&quot;service&quot;);
                jsimple = jsimple.proxify();

                jsimple.service.should.be.equal(fetchedService);
                (&quot;otherService&quot; in jsimple).should.be.true;
                jsimple.tagged(&quot;tag&quot;).should.be.eql([&quot;taggedService&quot;]);
            });
        })
    });
});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.0)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
